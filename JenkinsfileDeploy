pipeline {
    environment {
        dockerImage = ''
        imageName = 'nlafontaine/capstone-b-safe'
        registryCred = 'Dockerhub'
    }
    agent { label 'Jenkins-Slave2'}

    options { 
         skipDefaultCheckout()
         disableConcurrentBuilds()
     }

     triggers {
         upstream(upstreamProjects: 'B-Safe-Docker-Deployment')
     }

    stages {
        stage('Checkout') {
            steps {
                script {
                    docker.withRegistry('', registryCred) {
                        dockerImage = docker.image(imageName)
                        dockerImage.pull()
                    }
                }
            }
        } 
        stage('Run image') {
            steps {
                script {
                    dockerImage.run('--name b-safe -p 8090:8090')
                }
            }
        }
    }
}